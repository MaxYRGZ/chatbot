<div id="chatbot" class="chatbot-container">
  <h2 class="chatbot-title">Asistente de Ventas</h2>
  <div id="chat-messages" class="chat-messages"></div>
  <div class="chat-input">
    <input type="text" id="chatbot-input" placeholder="Escribe tu mensaje...">
    <button id="send-message" class="btn btn-primary">Enviar</button>
    <button id="start-listening" class="btn btn-secondary">Escuchar</button>
    <button id="speak-response" class="btn btn-info">Hablar respuesta</button>
  </div>
  <div id="chatbot-response" class="chatbot-response"></div>
</div>

<style>
.chatbot-container {
  max-width: 600px;
  margin: 20px auto;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  background-color: #f9f9f9;
  font-family: Arial, sans-serif;
}

.chatbot-title {
  text-align: center;
  margin-bottom: 20px;
  color: #333;
}

.chat-messages {
  height: 300px;
  overflow-y: auto;
  border: 1px solid #eee;
  padding: 10px;
  margin-bottom: 20px;
  background-color: #fff;
}

.chat-input {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.chat-input input {
  flex-grow: 1;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.btn {
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.btn-primary {
  background-color: #007bff;
  color: white;
}

.btn-secondary {
  background-color: #6c757d;
  color: white;
}

.btn-info {
  background-color: #17a2b8;
  color: white;
}

.btn:hover {
  opacity: 0.8;
}

.chatbot-response {
  background-color: #e9ecef;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
}

#chat-messages p {
  margin: 5px 0;
  padding: 8px;
  border-radius: 8px;
}

#chat-messages p:nth-child(odd) {
  background-color: #e6f2ff;
  text-align: right;
}

#chat-messages p:nth-child(even) {
  background-color: #f0f0f0;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
  document.getElementById('send-message').addEventListener('click', () => {
    const input = document.getElementById('chatbot-input');
    const message = input.value;
    input.value = '';

    fetch('/chatbot/send_message', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({ message: message })
    })
    .then(response => response.json())
    .then(data => {
      document.getElementById('chat-messages').innerHTML += `<p>Tú: ${message}</p><p>Bot: ${data.response}</p>`;
      document.getElementById('chatbot-response').innerText = data.response;
    });
  });

  // Código para reconocimiento de voz
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'es-ES';

  document.getElementById('start-listening').addEventListener('click', () => {
    recognition.start();
  });

  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById('chatbot-input').value = transcript;
  };

  // Código para síntesis de voz
  document.getElementById('speak-response').addEventListener('click', () => {
    const response = document.getElementById('chatbot-response').innerText;
    const utterance = new SpeechSynthesisUtterance(response);
    utterance.lang = 'es-ES';
    window.speechSynthesis.speak(utterance);
  });
});
</script>